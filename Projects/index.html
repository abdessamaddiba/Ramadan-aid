<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sofra ‚Äî La table est ouverte pour tous</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg-left:#0a0b14;--bg-right:#07080f;
  --surface:rgba(255,255,255,0.04);--surface2:rgba(255,255,255,0.07);
  --border:rgba(255,255,255,0.07);--border2:rgba(255,255,255,0.11);
  --text1:#eef0ff;--text2:#8892b8;--text3:#454d6e;
  --gold:#c9a84c;--gold2:#e2b95a;
  --gold-dim:rgba(201,168,76,0.12);--gold-glow:rgba(201,168,76,0.08);
}
html,body{height:100%;font-family:'Montserrat',sans-serif;background:var(--bg-left);color:var(--text1);overflow:hidden}
nav{position:fixed;top:0;left:0;right:0;height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 28px;background:rgba(10,11,20,0.9);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);z-index:200}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none}
/* ‚îÄ‚îÄ NAVBAR LOGO ‚îÄ‚îÄ */
.logo-word{display:flex;align-items:baseline;gap:0;text-decoration:none;line-height:1}
.logo-s-styled{font-family:'Montserrat',sans-serif;font-weight:900;font-size:1.3rem;color:#c9a84c;letter-spacing:-0.01em}
.logo-ofra{font-family:'Montserrat',sans-serif;font-weight:300;font-size:1.3rem;color:var(--text1);letter-spacing:0.22em;padding-left:1px}

.nav-mid{position:absolute;left:50%;transform:translateX(-50%);font-size:0.68rem;color:var(--text3);letter-spacing:0.05em;font-weight:500;white-space:nowrap}
.nav-right{display:flex;align-items:center;gap:8px}
.lang-pill{display:flex;align-items:center;background:var(--surface);border:1px solid var(--border2);border-radius:8px;overflow:hidden}
.lbtn{background:none;border:none;color:var(--text3);font-size:0.68rem;font-weight:700;font-family:'Montserrat',sans-serif;padding:5px 9px;cursor:pointer;transition:all 0.15s;letter-spacing:0.05em}
.lbtn:hover{color:var(--text1)}
.lbtn.active{background:var(--gold-dim);color:var(--gold)}
.staff-btn{display:flex;align-items:center;gap:6px;background:var(--surface);border:1px solid var(--border2);color:var(--text2);font-family:'Montserrat',sans-serif;font-size:0.72rem;font-weight:600;padding:6px 14px;border-radius:8px;cursor:pointer;transition:all 0.2s;text-decoration:none;letter-spacing:0.03em}
.staff-btn:hover{border-color:var(--gold);color:var(--gold);background:var(--gold-glow)}
.layout{display:flex;height:100vh;padding-top:56px}
.left{width:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:32px 56px;background:var(--bg-left);position:relative;overflow:hidden}
.left::before{content:'';position:absolute;width:400px;height:400px;background:radial-gradient(circle,rgba(201,168,76,0.05),transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none}
.left-inner{width:100%;max-width:380px;position:relative;z-index:1}



.tagline-fr{font-size:0.92rem;font-weight:300;color:var(--text2);letter-spacing:0.02em;margin-bottom:6px;animation:fadeUp 0.5s 0.1s both}
.hero-title{font-family:'Montserrat',sans-serif;font-weight:300;font-size:2.6rem;letter-spacing:0.35em;color:var(--text1);line-height:1;margin-bottom:12px;animation:fadeUp 0.5s both}
.hero-s-gold{color:#c9a84c;font-weight:900}
.tagline-ar{font-family:'Amiri',serif;font-size:1.1rem;color:var(--gold);opacity:0.9;margin-bottom:4px;animation:fadeUp 0.5s 0.15s both}
.hr{width:36px;height:1.5px;background:linear-gradient(90deg,var(--gold),transparent);margin:24px 0;animation:fadeUp 0.5s 0.2s both}
.btns{display:flex;flex-direction:column;gap:10px;animation:fadeUp 0.5s 0.25s both}
.abtn{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-radius:10px;border:1px solid var(--border2);background:var(--surface);cursor:pointer;transition:all 0.2s;text-decoration:none;position:relative;overflow:hidden;gap:12px}
.abtn::after{content:'';position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,var(--gold-dim),transparent);transition:width 0.3s ease}
.abtn:hover{border-color:rgba(201,168,76,0.4);transform:translateX(3px)}
.abtn:hover::after{width:100%}
.abtn.primary{border-color:rgba(201,168,76,0.25);background:rgba(201,168,76,0.04)}
.abtn.primary:hover{border-color:var(--gold)}
.abtn-left{display:flex;flex-direction:column;gap:3px;position:relative;z-index:1}
.abtn-title{font-size:0.88rem;font-weight:700;color:var(--text1)}
.abtn-sub{font-size:0.68rem;font-weight:400;color:var(--text3)}
.abtn-right{display:flex;align-items:center;gap:8px;position:relative;z-index:1;flex-shrink:0}
.abtn-icon{width:30px;height:30px;border-radius:7px;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-size:0.9rem}
.abtn-arr{color:var(--text3);transition:all 0.2s;display:flex}
.abtn:hover .abtn-arr{color:var(--gold);transform:translateX(3px)}
.stats{display:flex;gap:24px;margin-top:24px;animation:fadeUp 0.5s 0.35s both;padding-top:20px;border-top:1px solid var(--border)}
.stt{position:relative;cursor:default}
.stt-num{position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:rgba(12,15,28,0.95);color:var(--gold);font-size:0.9rem;font-weight:800;padding:4px 10px;border-radius:8px;border:1px solid rgba(201,168,76,0.3);white-space:nowrap;opacity:0;pointer-events:none;transition:opacity 0.2s,transform 0.2s;transform:translateX(-50%) translateY(4px)}
.stt-num::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:rgba(201,168,76,0.3)}
.stt:hover .stt-num{opacity:1;transform:translateX(-50%) translateY(0)}
.stt-num{font-size:1.1rem;font-weight:800;color:var(--gold);min-width:24px}
.stt-lbl{font-size:0.58rem;color:var(--text3);letter-spacing:0.07em;text-transform:uppercase;margin-top:2px}
.right{width:50%;background:var(--bg-right);position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
.right::before{content:'';position:absolute;left:0;top:10%;bottom:10%;width:1px;background:linear-gradient(180deg,transparent,var(--border2),transparent)}
.pattern{position:absolute;inset:0;opacity:0.1}
.pattern svg{width:100%;height:100%}
.glow{position:absolute;width:320px;height:320px;background:radial-gradient(circle,rgba(201,168,76,0.1),transparent 70%);border-radius:50%;animation:pulse 5s ease-in-out infinite;pointer-events:none}
.lantern-wrap{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;gap:18px;animation:float 7s ease-in-out infinite}
.lantern{width:130px;filter:drop-shadow(0 0 24px rgba(201,168,76,0.25)) drop-shadow(0 0 60px rgba(201,168,76,0.1))}
.ll1{font-family:'Amiri',serif;font-size:1.3rem;color:var(--gold);letter-spacing:0.05em;text-align:center}
.ll2{font-size:0.62rem;color:var(--text3);letter-spacing:0.12em;text-transform:uppercase;margin-top:4px;text-align:center}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-14px)}}
@keyframes pulse{0%,100%{opacity:0.7;transform:scale(1)}50%{opacity:1;transform:scale(1.08)}}
[dir="rtl"] .abtn:hover{transform:translateX(-3px)}
[dir="rtl"] .abtn::after{left:auto;right:0;background:linear-gradient(270deg,var(--gold-dim),transparent)}
[dir="rtl"] .abtn-arr svg{transform:scaleX(-1)}
[dir="rtl"] .hr{background:linear-gradient(270deg,var(--gold),transparent)}

@media(max-width:768px){
  html,body{overflow:auto}
  .layout{flex-direction:column;height:auto}
  .right{width:100%;height:240px;order:0}
  .left{width:100%;padding:28px 20px;order:1}
  .right::before{display:none}
  .nav-mid{display:none}
  .lantern{width:80px}
}

/* ‚îÄ‚îÄ ANNOUNCEMENTS ‚îÄ‚îÄ */
.ann-banner{margin-bottom:18px;animation:fadeUp 0.5s 0.05s both}
.ann-item{background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:12px;padding:12px 16px;margin-bottom:8px}
.ann-item.pinned{border-color:rgba(201,168,76,0.5);background:rgba(201,168,76,0.12)}
.ann-pin{font-size:0.6rem;color:var(--gold);font-weight:700;text-transform:uppercase;letter-spacing:0.08em;margin-bottom:4px}
.ann-text{font-size:0.82rem;color:var(--text1);line-height:1.6;white-space:pre-wrap}
.ann-time{font-size:0.65rem;color:var(--text3);margin-top:5px}
.notif-prompt{background:rgba(59,130,246,0.08);border:1px solid rgba(59,130,246,0.2);border-radius:12px;padding:12px 14px;margin-bottom:16px;display:flex;align-items:center;gap:10px;animation:fadeUp 0.5s 0.05s both;cursor:pointer;transition:all 0.2s}
.notif-prompt:hover{border-color:rgba(59,130,246,0.4)}
.notif-prompt-text{flex:1;font-size:0.78rem;color:var(--text2);line-height:1.5}
.notif-prompt-btn{flex-shrink:0;background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.3);color:#60a5fa;font-size:0.72rem;font-weight:700;padding:5px 10px;border-radius:7px;cursor:pointer;white-space:nowrap}
/* ‚îÄ‚îÄ HILAL + LANTERN ANIMATIONS ‚îÄ‚îÄ */
@keyframes sway{
  0%,100%{transform:rotate(-5deg)}
  50%{transform:rotate(5deg)}
}
@keyframes hilalPulse{
  0%,100%{opacity:0.85}
  50%{opacity:1}
}
#swayGroup{
  transform-box:fill-box;
  transform-origin:0px 0px;
  animation:sway 4.2s ease-in-out infinite;
}
/* ‚îÄ‚îÄ LANTERN ANIMATIONS ‚îÄ‚îÄ */
@keyframes sway1{0%,100%{transform:translate(80px,295px) rotate(-3deg)}50%{transform:translate(80px,295px) rotate(3deg)}}
@keyframes sway2{0%,100%{transform:translate(175px,315px) rotate(-2.5deg)}50%{transform:translate(175px,315px) rotate(2.5deg)}}
@keyframes sway3{0%,100%{transform:translate(345px,315px) rotate(2deg)}50%{transform:translate(345px,315px) rotate(-2deg)}}
@keyframes sway4{0%,100%{transform:translate(440px,295px) rotate(3deg)}50%{transform:translate(440px,295px) rotate(-3deg)}}
@keyframes twinkle{0%,100%{opacity:0.5}50%{opacity:1}}
@keyframes glowPulse{0%,100%{opacity:0.06}50%{opacity:0.12}}
@keyframes floatCrescent{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
#lantern1{animation:sway1 4.2s ease-in-out infinite;transform-origin:80px 295px}
#lantern2{animation:sway2 3.8s ease-in-out infinite 0.4s;transform-origin:175px 315px}
#lantern3{animation:sway3 4.5s ease-in-out infinite 0.8s;transform-origin:345px 315px}
#lantern4{animation:sway4 4s ease-in-out infinite 0.2s;transform-origin:440px 295px}
#gs1,#gs2,#gs3{animation:twinkle 2.5s ease-in-out infinite}
#gs2{animation-delay:0.8s}
#gs3{animation-delay:1.4s}
</style>
</head>
<body>
<nav>
  <a class="logo" href="#">
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIIAAADICAYAAAAkwDn3AAAHsElEQVR4nO2d23XsNgxFkbvcU5pwASnRBaQJV+V8ZJjFO9FoCBIEDoizP5Pr4WsLhChKFCnO99fnz/fX5090PaL5I7oCUbwa/D//+rtkn/yKrkAEdxGganQoZb92kCtFhxINXb3KKwhxdAOtw/zJQhybI+yY60/OH44z3GuwTosOxzRmVoA2oKt/n50jGmE1iCvRJLsQqSu/6yquGB1SVtxroCoJkarCUQNTQYg0t4+RgzH7G5luN+GNRbsa0epjBWzl0DscvX5a4CqV6RYuU13fAVWZrFdZ1nr3QFQE5W6g8t1FySvpXbkVhQgpOHJuHS07SgaLsmdwLxA1CpxWrha3wiI7BGGHEroQ2wvx7oDvr8+f/m+tVveef9N7tXG3EFuXmD0b7f1+wmx5qMvVHzt+NCIKzPydBTPRYXYzTPv3O6KDqQiVBOiZHSAkIUxE8L5VQhHgmcxCLOcIK1FgZqMIqgQ9GfOH6YhQdRrQkCl/UItAAXRkmS6GRWAesMaKEDN9oS1vSATv9YCZsrIwI8TKuxej09OtCJwG9oGWP1yKQAF8QMof/nf7ePKyMCoIt5sfd//TuzLViZwuPigAFlHThXod4SQBLF+CtcZbCJUIp9wOvmrH6ivyO/Bafxh61jDzXEAEq0MbI+1A2FX8zGwyabKgdPI0MPrvkdqyc7qA2I+wk9WrGzk6WNbNZKsa0nqAx8ChyGHZ72H7EayZzWOylHeHxRhMi1AtCiCW3bM6Hls2r3qBMgiIiaWWlCKgCPBMZiFSiYAqwDMZhUjzDaUsEvRkqjN8RMjUmVdkiQ6wImQX4Bl0ISCnhtMk6EFtG1REQO0kaxCjA4QIVQR4BkmIUBGqCvAMghCQOQLxhyIQEaEI5AFFICJCEcgDikBEhCKQBxSBiAhFIA8oAhERigBF5M5oigDIihCzzysoAjAr75xqhaAICfCIDhQhCbujQ6gISG9LZWHXJwogIgKF0GN9dwEhQoMy6LC83YQSQYTRYQYLIeBEaFAIPStCwIrQoBB6ZmSAF6FBGXRoo0MaEUQYHWYYFSKVCA0KoeedEClFaFAIPa9kmBbhtI9JVeJq7JYjApIMFEJHL8Tt93pnjuNbrZwVKIJmwTRHQJsukMREZ+gL3tm/yYwiJzKqT7ln/0I7hXiN+kzB7NFBhEJcMXW4pEh+ISjD7/zXGRSiNmZnGjF/yM1l46tGB5G6Qtw2uqoQFWUYanDVQ8IrCTHcUOYP+9lxVtMobgOUfboQ2T9AfVu9ZZgurKoQOwfoqo1eQiwXwvzBDssnwVpMfrxqdBCxHaCdDwDfYfIYmkft5S9vS2eOVtZqMFEixGp7vB4AXrFl86r31YoUHTyltCxvewd6J0Ao0UHENyFe7Uu3K8n71ghFCO+EeLY895DquWiCIoMIvhAhc6v3Ump2ITyW9yGSLC+qCjFSVikRGihCIE0XJUUQwZFBBEOIsiI0sgthlT+UF6GBIkRUdKAIT1QVgiJcgCKDiJ8QFOGG7EJo6k8RBkARYmd0oAiDoMggskcIiqAksxB3df+F1LAMoO2Oshq/X9Y/WAU0IVZ/47cdShRCD5IMK2N3uVWNMuhAig6zvNyzyOigJ7MQbzevUgg9GYUY3sVMIfRkkkG9nZ0y6MgSHabea2B00IMuxNILLhRCD6oQJm86UQY9aDKYvfLG6KAHKTrciuB1QHV1EIR4GxE8TywncQxPDSd81IK8RpUjMDqcy1SyuBIdKAQmIae8UQg8Uh/3R+ygCEREKAJ5QBGIiFAE8oAiEBGhCOQBRSAiQhHIA4pARETkI7LwyKNrkEBYbg8VoVFVCAQBGlBTA1LH7AatrRARoef06IAmQANOhMZpQqAK0IAVoZFdCHQBGlA5wh1ZOrQnU53hI0JPluiQSYBGKhEaqEJkFKCRUoQGihCZBWhM5wgIb+c0IgcCRYLV8VhOFpFkyHrU3ioWY5DyJNg7PAYHSQCrfjfNEVqlUDrqVHZcdLcizCZjFGIPO98/HYoIK0JEy7ByzqTnGZXv2P2ZftXU8P31+ZM5OowKjVDXhtdb6Ooc4YTp4k5ohPqJBB7l430W8c4O7+v0rpxRQTW/uULU4V6/nv/DTAVmKhE95zayrwes1L8v7+Pqf8z8cPb8IRKEA0Avc4TZATohf/AEQYDGbbIYIUQVGdAOCR+6a5gdoBkhTo8Okcf+3jF8+8j8YQ2kaeAK9ToC8wcd6AI0ph86MX94D1oecEfYfoTZtQeU9Yc7Vr5HOVvezN/1mDyG5nTxL1mmgSsg9iNkFyKzAI0t7zV4f6o3crqIXBa2ZOsLLifnDxF5wM72uXVc1BVgNW1E1cNLbveQmvVx9wl5wB0hc6vHkqlVeRFlRuQ8Kd8Q8ro6T48CPRCLM2hCVBKgEV6BHs+OfFVWthVBK2Aq0ojKHypGgR6oyvSgdzB6/bRAVqoHrcPR6mMFdOV6ogcguvzdpPmGUuSC0ukSiCSKCD1eA1NBgEa6CvfsGqhKAjTSVrxhebuZbVnYktSV71m9iitGgZ4jGtHjtVvpFAEaRzWmZ5cQpwnQSHP7qGXHgJ0qgcjBEaEnYj9CNo5vYI/XfoSMlGloz679CJk5Nke4426gK0pABOvTOZH8Azng+A4QGD3VAAAAAElFTkSuQmCC" style="width:32px;height:32px;object-fit:contain" alt="Sofra"/>
  </a>
  <div class="nav-mid" data-i18n="nav_tagline">Aide alimentaire pour √©tudiants ¬∑ Ramadan 2026</div>
  <div class="nav-right">
    <div class="lang-pill">
      <button class="lbtn active" onclick="setLang('fr')">FR</button>
      <button class="lbtn" onclick="setLang('ar')">AR</button>
      <button class="lbtn" onclick="setLang('en')">EN</button>
    </div>
    <a href="dashboard.html" class="staff-btn">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M15 12H3"/></svg>
      <span data-i18n="staff_login">Connexion Staff</span>
    </a>
  </div>
</nav>

<div class="layout">
  <div class="left">
    <div class="left-inner">
      <div class="hero-title">SOFRA</div>
      <div class="tagline-fr" data-i18n="tagline_fr">La table est ouverte pour tous</div>
      <div class="tagline-ar">ÿ™ŸÇÿ®ŸÑ ÿßŸÑŸÑŸá ÿµŸäÿßŸÖŸÉŸÖ ŸàŸÇŸäÿßŸÖŸÉŸÖ</div>
      <div class="hr"></div>
      <!-- NOTIFICATION PROMPT -->
      <div class="notif-prompt" id="notifPrompt" style="display:none" onclick="requestNotifPermission()">
        <span style="font-size:1.4rem">üîî</span>
        <div class="notif-prompt-text" id="notifPromptText">Recevoir les annonces en temps r√©el ? Activez les notifications.</div>
        <div class="notif-prompt-btn" id="notifPromptBtn">Activer</div>
      </div>

      <!-- LIVE ANNOUNCEMENTS -->
      <div class="ann-banner" id="annBanner" style="display:none">
        <div style="font-size:0.62rem;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px;display:flex;align-items:center;gap:6px">
          <span style="width:6px;height:6px;background:var(--gold);border-radius:50%;display:inline-block;animation:twinkle 2s infinite"></span>
          <span id="ann-section-label">Annonces</span>
        </div>
        <div id="annList"></div>
      </div>

      <div class="btns">
        <a href="register.html" class="abtn primary">
          <div class="abtn-left">
            <div class="abtn-title" data-i18n="btn_new">Je suis nouveau</div>
            <div class="abtn-sub" data-i18n="btn_new_sub">Premi√®re inscription ‚Äî cr√©er mon profil</div>
          </div>
          <div class="abtn-right">
            <div class="abtn-icon">‚ú®</div>
            <div class="abtn-arr"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
          </div>
        </a>
        <a href="complete.html" class="abtn">
          <div class="abtn-left">
            <div class="abtn-title" data-i18n="btn_existing">J'ai d√©j√† donn√© mes infos</div>
            <div class="abtn-sub" data-i18n="btn_existing_sub">Compl√©ter mon profil ¬∑ v√©rifier mon statut</div>
          </div>
          <div class="abtn-right">
            <div class="abtn-icon">üåô</div>
            <div class="abtn-arr"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg></div>
          </div>
        </a>
      </div>
      <div class="stats">
        <div class="stt"><div class="stt-num" id="sTotal">‚Äî</div><div class="stt-lbl" data-i18n="s_students">√âtudiants</div></div>
        <div class="stt"><div class="stt-num" id="sFasting">‚Äî</div><div class="stt-lbl" data-i18n="s_fasting">En je√ªne</div></div>
        <div class="stt"><div class="stt-num" id="sServed">‚Äî</div><div class="stt-lbl" data-i18n="s_served">Servis</div></div>
      </div>
    </div>
  </div>

  <div class="right">
  <svg id="hilalScene" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 580"
       style="position:absolute;inset:0;width:100%;height:100%">
    <defs>
      <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
        <feGaussianBlur stdDeviation="8" result="b"/>
        <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      <filter id="sg" x="-30%" y="-30%" width="160%" height="160%">
        <feGaussianBlur stdDeviation="3.5" result="b"/>
        <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      <radialGradient id="warmGlow" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="rgba(255,195,60,0.45)"/>
        <stop offset="60%" stop-color="rgba(255,160,40,0.15)"/>
        <stop offset="100%" stop-color="rgba(201,168,76,0)"/>
      </radialGradient>
      <radialGradient id="hilalGrad" cx="35%" cy="40%" r="65%">
        <stop offset="0%" stop-color="rgba(201,168,76,0.14)"/>
        <stop offset="100%" stop-color="rgba(201,168,76,0.03)"/>
      </radialGradient>
    </defs>

    <!-- Subtle dot grid -->
    <pattern id="dpat" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse">
      <circle cx="15" cy="15" r="0.9" fill="#c9a84c" opacity="0.18"/>
    </pattern>
    <rect width="480" height="580" fill="url(#dpat)"/>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         HILAL ‚Äî thick, ornate crescent
         Outer circle: center(210,285) r=155
         Inner circle: center(255,270) r=130
         Top tip: (266,140)  Bottom tip: (342,367)
         Path: M 266,140 A155,155 0 1,0 342,367 A130,130 0 0,1 266,140 Z
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- Outer glow halo -->
    <path d="M 266,140 A 155,155 0 1,0 342,367 A 130,130 0 0,1 266,140 Z"
          fill="rgba(201,168,76,0.07)" stroke="none" filter="url(#glow)"/>

    <!-- Main crescent fill -->
    <path d="M 266,140 A 155,155 0 1,0 342,367 A 130,130 0 0,1 266,140 Z"
          fill="url(#hilalGrad)" stroke="#c9a84c" stroke-width="2" opacity="0.85"/>

    <!-- Parallel ribs for depth (inner concentric arcs) -->
    <path d="M 270,147 A 148,148 0 1,0 337,360 A 137,137 0 0,1 270,147 Z"
          fill="none" stroke="#c9a84c" stroke-width="0.7" opacity="0.4"/>
    <path d="M 274,155 A 140,140 0 1,0 331,352 A 144,144 0 0,1 274,155 Z"
          fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.25"/>

    <!-- ‚îÄ‚îÄ Arabesque ornaments along crescent body ‚îÄ‚îÄ -->
    <!-- 8-pointed star at crescent belly (~55,285) -->
    <g transform="translate(60,285)" opacity="0.65" stroke="#c9a84c" fill="none" stroke-width="0.8">
      <circle r="11"/>
      <circle r="7"/>
      <path d="M0,-11 L2.5,-2.5 L11,0 L2.5,2.5 L0,11 L-2.5,2.5 L-11,0 L-2.5,-2.5 Z" stroke-width="0.7"/>
      <circle cx="7.8" cy="7.8" r="1.5" fill="#c9a84c"/>
      <circle cx="-7.8" cy="7.8" r="1.5" fill="#c9a84c"/>
      <circle cx="7.8" cy="-7.8" r="1.5" fill="#c9a84c"/>
      <circle cx="-7.8" cy="-7.8" r="1.5" fill="#c9a84c"/>
    </g>
    <!-- Ornament upper-left belly -->
    <g transform="translate(68,210)" opacity="0.55" stroke="#c9a84c" fill="none" stroke-width="0.7">
      <circle r="8"/>
      <circle r="5"/>
      <path d="M0,-8 L2,0 L8,0 L2,2 L0,8 L-2,2 L-8,0 L-2,0 Z" stroke-width="0.7"/>
    </g>
    <!-- Ornament lower-left belly -->
    <g transform="translate(68,360)" opacity="0.55" stroke="#c9a84c" fill="none" stroke-width="0.7">
      <circle r="8"/>
      <circle r="5"/>
      <path d="M0,-8 L2,0 L8,0 L2,2 L0,8 L-2,2 L-8,0 L-2,0 Z" stroke-width="0.7"/>
    </g>
    <!-- Ornament upper crescent -->
    <g transform="translate(97,175)" opacity="0.5" stroke="#c9a84c" fill="none" stroke-width="0.7">
      <circle r="6"/>
      <circle r="3.5"/>
    </g>
    <!-- Ornament lower crescent -->
    <g transform="translate(115,395)" opacity="0.5" stroke="#c9a84c" fill="none" stroke-width="0.7">
      <circle r="6"/>
      <circle r="3.5"/>
    </g>

    <!-- Scrollwork near top tip -->
    <g transform="translate(266,140)" opacity="0.55" stroke="#c9a84c" fill="none" stroke-width="0.9">
      <path d="M-8,-3 C -14,-3 -18,2 -15,7 C -12,12 -6,11 -4,7"/>
      <path d="M8,-3 C 14,-3 18,2 15,7 C 12,12 6,11 4,7"/>
      <circle cx="0" cy="-8" r="2.5"/>
    </g>
    <!-- Scrollwork near bottom tip -->
    <g transform="translate(342,367)" opacity="0.45" stroke="#c9a84c" fill="none" stroke-width="0.8">
      <path d="M-6,-4 C -11,-4 -14,1 -11,6 C -8,10 -4,9 -3,6"/>
      <path d="M6,-4 C 11,-4 14,1 11,6 C 8,10 4,9 3,6"/>
    </g>

    <!-- Dot trail along outer crescent edge -->
    <g fill="#c9a84c">
      <circle cx="87" cy="168" r="1.8" opacity="0.4"/>
      <circle cx="68" cy="220" r="1.5" opacity="0.35"/>
      <circle cx="57" cy="285" r="2" opacity="0.5"/>
      <circle cx="67" cy="350" r="1.5" opacity="0.35"/>
      <circle cx="93" cy="395" r="1.8" opacity="0.4"/>
    </g>

    <!-- Stars -->
    <g fill="#c9a84c" filter="url(#sg)">
      <path d="M400,95 L402,102 L409,104 L402,106 L400,113 L398,106 L391,104 L398,102 Z" opacity="0.75"/>
      <path d="M430,200 L431.5,205 L437,206.5 L431.5,208 L430,213 L428.5,208 L423,206.5 L428.5,205 Z" opacity="0.55"/>
      <path d="M415,330 L416.5,334 L421,335.5 L416.5,337 L415,341 L413.5,337 L409,335.5 L413.5,334 Z" opacity="0.5"/>
      <circle cx="380" cy="155" r="2.5" opacity="0.6"/>
      <circle cx="445" cy="270" r="2" opacity="0.5"/>
      <circle cx="385" cy="430" r="2" opacity="0.45"/>
      <circle cx="150" cy="90" r="1.8" opacity="0.35"/>
      <circle cx="360" cy="105" r="1.5" opacity="0.4"/>
    </g>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         CHAIN + LANTERN  (sway pivot at 266,140)
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <g transform="translate(266,140)">
      <g id="swayGroup" style="transform-origin:0px 0px;animation:sway 4.2s ease-in-out infinite">

        <!-- Hanging ring at top -->
        <circle cx="0" cy="4" r="5.5" fill="none" stroke="#c9a84c" stroke-width="1.3" opacity="0.9"/>

        <!-- Chain links ‚Äî alternating H and V ellipses -->
        <g stroke="#c9a84c" fill="none" stroke-width="1.2" opacity="0.85">
          <ellipse cx="0" cy="16"  rx="3.5" ry="6"/>
          <ellipse cx="0" cy="28"  rx="6" ry="3.5"/>
          <ellipse cx="0" cy="40"  rx="3.5" ry="6"/>
          <ellipse cx="0" cy="52"  rx="6" ry="3.5"/>
          <ellipse cx="0" cy="64"  rx="3.5" ry="6"/>
          <ellipse cx="0" cy="76"  rx="6" ry="3.5"/>
          <ellipse cx="0" cy="88"  rx="3.5" ry="6"/>
          <ellipse cx="0" cy="100" rx="6" ry="3.5"/>
          <ellipse cx="0" cy="112" rx="3.5" ry="6"/>
        </g>

        <!-- ‚îÄ‚îÄ ORNATE LANTERN  (top at y=118) ‚îÄ‚îÄ -->
        <g transform="translate(0,118)">

          <!-- TOP FINIAL -->
          <circle cx="0" cy="-14" r="5" fill="none" stroke="#c9a84c" stroke-width="1.2" opacity="0.9"/>
          <circle cx="0" cy="-14" r="2.5" fill="#c9a84c" opacity="0.7"/>
          <line x1="0" y1="-9" x2="0" y2="-4" stroke="#c9a84c" stroke-width="1.2" opacity="0.7"/>

          <!-- DOME CAP -->
          <path d="M -26,0 C -26,-14 -16,-26 0,-30 C 16,-26 26,-14 26,0 Z"
                fill="rgba(201,168,76,0.1)" stroke="#c9a84c" stroke-width="1.3" opacity="0.9"/>
          <!-- Dome ribs -->
          <g stroke="#c9a84c" stroke-width="0.7" opacity="0.5">
            <path d="M 0,-30 L -20,0"/>
            <path d="M 0,-30 L -12,0"/>
            <path d="M 0,-30 L 0,0"/>
            <path d="M 0,-30 L 12,0"/>
            <path d="M 0,-30 L 20,0"/>
          </g>
          <!-- Dome base ring -->
          <ellipse cx="0" cy="0" rx="26" ry="5.5" fill="rgba(201,168,76,0.08)"
                   stroke="#c9a84c" stroke-width="1.2" opacity="0.85"/>
          <!-- Small bud finials on dome rim -->
          <g fill="none" stroke="#c9a84c" stroke-width="1" opacity="0.7">
            <circle cx="-20" cy="-1" r="2.5"/>
            <circle cx="-10" cy="-2.5" r="2.5"/>
            <circle cx="0"   cy="-3" r="2.8"/>
            <circle cx="10"  cy="-2.5" r="2.5"/>
            <circle cx="20"  cy="-1" r="2.5"/>
          </g>

          <!-- UPPER COLLAR BAND -->
          <rect x="-27" y="5" width="54" height="9" rx="2"
                fill="rgba(201,168,76,0.08)" stroke="#c9a84c" stroke-width="1" opacity="0.85"/>
          <!-- Pearls/dots on collar -->
          <g fill="#c9a84c" opacity="0.55">
            <circle cx="-20" cy="9.5" r="1.5"/>
            <circle cx="-12" cy="9.5" r="1.5"/>
            <circle cx="-4"  cy="9.5" r="1.5"/>
            <circle cx="4"   cy="9.5" r="1.5"/>
            <circle cx="12"  cy="9.5" r="1.5"/>
            <circle cx="20"  cy="9.5" r="1.5"/>
          </g>

          <!-- MAIN BODY FRAME -->
          <rect x="-26" y="14" width="52" height="92" rx="3"
                fill="rgba(255,185,50,0.06)" stroke="#c9a84c" stroke-width="1.3" opacity="0.9"/>
          <!-- Side pillar lines -->
          <line x1="-26" y1="14" x2="-20" y2="106" stroke="#c9a84c" stroke-width="0.8" opacity="0.5"/>
          <line x1="26"  y1="14" x2="20"  y2="106" stroke="#c9a84c" stroke-width="0.8" opacity="0.5"/>

          <!-- GOTHIC ARCH WINDOWS ‚Äî upper body (3 arches) -->
          <!-- Left arch -->
          <path d="M -22,106 L -22,55 Q -22,42 -15,42 Q -8,42 -8,55 L -8,106"
                fill="none" stroke="#c9a84c" stroke-width="0.9" opacity="0.75"/>
          <!-- Double tracery left arch -->
          <path d="M -20,106 L -20,56 Q -20,46 -15,46 Q -10,46 -10,56 L -10,106"
                fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.4"/>
          <!-- Center arch (tallest) -->
          <path d="M -6,106 L -6,48 Q -6,32 0,32 Q 6,32 6,48 L 6,106"
                fill="rgba(255,195,60,0.1)" stroke="#c9a84c" stroke-width="1" opacity="0.85"/>
          <!-- Double tracery center -->
          <path d="M -4,106 L -4,50 Q -4,36 0,36 Q 4,36 4,50 L 4,106"
                fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.4"/>
          <!-- Right arch -->
          <path d="M 8,106 L 8,55 Q 8,42 15,42 Q 22,42 22,55 L 22,106"
                fill="none" stroke="#c9a84c" stroke-width="0.9" opacity="0.75"/>
          <!-- Double tracery right arch -->
          <path d="M 10,106 L 10,56 Q 10,46 15,46 Q 20,46 20,56 L 20,106"
                fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.4"/>

          <!-- Arch keystones -->
          <circle cx="-15" cy="42" r="2.5" fill="#c9a84c" opacity="0.6" filter="url(#sg)"/>
          <circle cx="0"   cy="32" r="3"   fill="#c9a84c" opacity="0.7" filter="url(#sg)"/>
          <circle cx="15"  cy="42" r="2.5" fill="#c9a84c" opacity="0.6" filter="url(#sg)"/>

          <!-- MID COLLAR BAND -->
          <rect x="-26" y="106" width="52" height="8" rx="2"
                fill="rgba(201,168,76,0.08)" stroke="#c9a84c" stroke-width="1" opacity="0.8"/>
          <g fill="#c9a84c" opacity="0.5">
            <circle cx="-18" cy="110" r="1.5"/>
            <circle cx="-8"  cy="110" r="1.5"/>
            <circle cx="0"   cy="110" r="1.5"/>
            <circle cx="8"   cy="110" r="1.5"/>
            <circle cx="18"  cy="110" r="1.5"/>
          </g>

          <!-- LOWER BODY ‚Äî diamond mesh -->
          <rect x="-22" y="114" width="44" height="38" rx="2"
                fill="rgba(255,185,50,0.05)" stroke="#c9a84c" stroke-width="0.8" opacity="0.6"/>
          <g stroke="#c9a84c" stroke-width="0.55" fill="none" opacity="0.4">
            <path d="M -22,114 L 0,133 L 22,114"/>
            <path d="M -22,152 L 0,133 L 22,152"/>
            <path d="M -22,124 L -11,133 M 11,133 L 22,124"/>
            <path d="M -22,142 L -11,133 M 11,133 L 22,142"/>
            <line x1="0" y1="114" x2="0" y2="152"/>
          </g>

          <!-- LOWER COLLAR -->
          <rect x="-26" y="152" width="52" height="8" rx="2"
                fill="rgba(201,168,76,0.08)" stroke="#c9a84c" stroke-width="1" opacity="0.8"/>

          <!-- BASE PLATFORM (widens) -->
          <path d="M -26,160 L -32,175 L 32,175 L 26,160 Z"
                fill="rgba(201,168,76,0.07)" stroke="#c9a84c" stroke-width="1.1" opacity="0.85"/>
          <!-- Small arches on base platform -->
          <g stroke="#c9a84c" stroke-width="0.7" fill="none" opacity="0.55">
            <path d="M -30,175 Q -26,168 -22,175"/>
            <path d="M -22,175 Q -18,168 -14,175"/>
            <path d="M -14,175 Q -10,168 -6,175"/>
            <path d="M -6,175 Q -2,168 2,175"/>
            <path d="M 2,175 Q 6,168 10,175"/>
            <path d="M 10,175 Q 14,168 18,175"/>
            <path d="M 18,175 Q 22,168 26,175"/>
            <path d="M 22,175 Q 26,168 30,175"/>
          </g>
          <line x1="-32" y1="175" x2="32" y2="175" stroke="#c9a84c" stroke-width="1" opacity="0.6"/>

          <!-- HANGING PENDANTS (6) -->
          <g stroke="#c9a84c" stroke-width="0.9" fill="none" opacity="0.65">
            <line x1="-24" y1="175" x2="-24" y2="184"/>
            <ellipse cx="-24" cy="188" rx="2.5" ry="3.5"/>
            <line x1="-14" y1="175" x2="-14" y2="183"/>
            <ellipse cx="-14" cy="187" rx="2" ry="2.8"/>
            <line x1="-5" y1="175" x2="-5" y2="184"/>
            <ellipse cx="-5" cy="188" rx="2.5" ry="3.5"/>
            <line x1="5" y1="175" x2="5" y2="184"/>
            <ellipse cx="5" cy="188" rx="2.5" ry="3.5"/>
            <line x1="14" y1="175" x2="14" y2="183"/>
            <ellipse cx="14" cy="187" rx="2" ry="2.8"/>
            <line x1="24" y1="175" x2="24" y2="184"/>
            <ellipse cx="24" cy="188" rx="2.5" ry="3.5"/>
          </g>

          <!-- BOTTOM FINIAL -->
          <line x1="0" y1="175" x2="0" y2="190" stroke="#c9a84c" stroke-width="1.2" opacity="0.7"/>
          <path d="M -8,190 Q 0,194 8,190 Q 0,200 -8,190 Z"
                fill="rgba(201,168,76,0.15)" stroke="#c9a84c" stroke-width="0.9" opacity="0.7"/>
          <line x1="0" y1="200" x2="0" y2="210" stroke="#c9a84c" stroke-width="1" opacity="0.6"/>
          <circle cx="0" cy="214" r="4" fill="none" stroke="#c9a84c" stroke-width="1" opacity="0.65"/>
          <circle cx="0" cy="214" r="1.8" fill="#c9a84c" opacity="0.5"/>
          <path d="M 0,218 Q 3,224 0,230 Q -3,224 0,218 Z"
                fill="none" stroke="#c9a84c" stroke-width="0.9" opacity="0.5"/>

          <!-- Inner warm glow -->
          <ellipse cx="0" cy="72" rx="18" ry="36" fill="url(#warmGlow)" opacity="0.8"/>

        </g><!-- end lantern -->
      </g><!-- end swayGroup -->
    </g><!-- end pivot translate -->

    <!-- Sofra text -->
    <text x="240" y="532" text-anchor="middle"
          font-family="'Amiri',serif" font-size="22"
          fill="#c9a84c" opacity="0.85"
          filter="url(#sg)">ÿ≥ŸÅÿ±ÿ© ¬∑ Sofra</text>
    <text x="240" y="550" text-anchor="middle"
          font-family="'Montserrat',sans-serif" font-size="8"
          fill="rgba(201,168,76,0.5)" letter-spacing="3">RAMADAN 1447 ¬∑ 2026</text>

  </svg>
</div>




<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyB_SeMMk-2mL_XYTKEemoIeh_j2odQ6LNk",
  authDomain:"ramadan-food-aid.firebaseapp.com",
  projectId:"ramadan-food-aid",
  storageBucket:"ramadan-food-aid.firebasestorage.app",
  messagingSenderId:"836613630009",
  appId:"1:836613630009:web:c5b3047298224ec82f05e8"
});
const db=firebase.firestore();

// ‚îÄ‚îÄ SERVICE MODE CHECK ‚îÄ‚îÄ
(async()=>{
  try{
    const snap=await db.doc('settings/serviceMode').get();
    if(snap.exists&&snap.data().active===false){
      document.body.innerHTML=`
        <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;
                    background:#07080f;font-family:'Montserrat',sans-serif;padding:24px">
          <div style="text-align:center;max-width:400px">
            <div style="font-size:3.5rem;margin-bottom:20px">üåô</div>
            <div style="font-size:1.8rem;font-weight:800;color:#c9a84c;letter-spacing:0.1em;margin-bottom:8px">SOFRA</div>
            <div style="font-size:0.8rem;color:rgba(201,168,76,0.6);letter-spacing:0.2em;text-transform:uppercase;margin-bottom:28px">Ramadan 1447 ¬∑ 2026</div>
            <div style="width:40px;height:1.5px;background:linear-gradient(90deg,transparent,#c9a84c,transparent);margin:0 auto 28px"></div>
            <div style="font-size:1rem;color:#8892b8;line-height:1.8;margin-bottom:24px">
              The service is temporarily paused.<br/>
              <span style="font-family:'Amiri',serif;font-size:1.1rem;color:#c9a84c">ÿßŸÑÿÆÿØŸÖÿ© ŸÖÿ™ŸàŸÇŸÅÿ© ŸÖÿ§ŸÇÿ™ÿßŸã</span><br/>
              Le service est temporairement suspendu.
            </div>
            <div style="font-size:0.72rem;color:#454d6e;line-height:1.8">
              If you need assistance, please contact the administration directly.
            </div>
          </div>
        </div>`;
      return;
    }
  }catch(e){ /* if check fails, page loads normally */ }

  // ‚îÄ‚îÄ REGISTER SERVICE WORKER ‚îÄ‚îÄ
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('sw.js').catch(()=>{});
  }

  // ‚îÄ‚îÄ NOTIFICATION PERMISSION PROMPT ‚îÄ‚îÄ
  if('Notification' in window && Notification.permission==='default'){
    const np=document.getElementById('notifPrompt');
    if(np)np.style.display='flex';
  }

  // ‚îÄ‚îÄ LIVE STATS ‚îÄ‚îÄ
  try{
    db.collection('people').onSnapshot(snap=>{
      const people=snap.docs.map(d=>d.data());
      const el=id=>document.getElementById(id);
      if(el('sTotal'))el('sTotal').textContent=people.length;
      if(el('sFasting'))el('sFasting').textContent=people.filter(p=>p.fasting).length;
      if(el('sServed'))el('sServed').textContent=people.filter(p=>p.served).length;
    });
  }catch(e){}

  // ‚îÄ‚îÄ LIVE ANNOUNCEMENTS ‚îÄ‚îÄ
  // NOTE: No .where() here ‚Äî that requires a composite Firestore index.
  // We filter active:true in JS instead. Simpler, no index needed.
  let knownAnnIds=new Set();
  let firstLoad=true;
  let swReg=null;
  // Keep a reference to the SW registration for direct notification calls
  if('serviceWorker' in navigator){
    navigator.serviceWorker.ready.then(reg=>{ swReg=reg; });
  }
  try{
    db.collection('announcements')
      .orderBy('createdAtMs','desc')
      .limit(10)
      .onSnapshot(snap=>{
        // Filter active in JS ‚Äî no composite index required
        const ann=snap.docs.map(d=>({id:d.id,...d.data()}))
                          .filter(a=>a.active!==false);
        const banner=document.getElementById('annBanner');
        const list=document.getElementById('annList');
        if(!banner||!list)return;
        if(ann.length===0){banner.style.display='none';return;}
        banner.style.display='block';
        ann.sort((a,b)=>(b.pinned?1:0)-(a.pinned?1:0)||(b.createdAtMs||0)-(a.createdAtMs||0));
        list.innerHTML=ann.map(a=>`
          <div class="ann-item${a.pinned?' pinned':''}">
            ${a.pinned?`<div class="ann-pin">üìå ${annLabel('pinned')}</div>`:''}
            <div class="ann-text">${esc2(a.text||'')}</div>
            <div class="ann-time">${timeAgo(a.createdAtMs||0)}</div>
          </div>`).join('');
        // Notifications for NEW announcements (not on initial page load)
        if(!firstLoad&&Notification.permission==='granted'){
          snap.docChanges().forEach(change=>{
            if(change.type==='added'&&!knownAnnIds.has(change.doc.id)){
              const a=change.doc.data();
              if(a.active===false)return;
              // Use swReg.showNotification ‚Äî works even before SW becomes controller
              if(swReg){
                swReg.showNotification('üåô Sofra ‚Äî '+annLabel('new_ann'),{
                  body:a.text||'',
                  tag:'sofra-ann-'+change.doc.id,
                  renotify:true
                });
              }
            }
          });
        }
        snap.docs.forEach(d=>knownAnnIds.add(d.id));
        firstLoad=false;
      });
  }catch(e){}
})();

function esc2(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function timeAgo(ms){
  if(!ms)return '';
  const diff=Date.now()-ms;
  const m=Math.floor(diff/60000);
  if(m<1)return '√Ä l\'instant';
  if(m<60)return m+'min';
  const h=Math.floor(m/60);
  if(h<24)return h+'h';
  return Math.floor(h/24)+'j';
}
function annLabel(key){
  const labels={
    pinned:{fr:'√âpingl√©',ar:'ŸÖÿ´ÿ®ÿ™',en:'Pinned'},
    new_ann:{fr:'Nouvelle annonce',ar:'ÿ•ÿπŸÑÿßŸÜ ÿ¨ÿØŸäÿØ',en:'New announcement'}
  };
  return (labels[key]||{})[lang]||(labels[key]||{}).fr||key;
}
window.requestNotifPermission=async function(){
  if(!('Notification' in window))return;
  const result=await Notification.requestPermission();
  const prompt=document.getElementById('notifPrompt');
  if(prompt)prompt.style.display='none';
  if(result==='granted'){
    // Use SW registration directly ‚Äî doesn't need .controller to be active yet
    if('serviceWorker' in navigator){
      navigator.serviceWorker.ready.then(reg=>{
        reg.showNotification('üåô Sofra',{
          body:lang==='ar'?'ÿ≥Ÿäÿ™ŸÖ ÿ•ÿπŸÑÿßŸÖŸÉ ÿ®ÿ£Ÿä ÿ™ÿ≠ÿØŸäÿ´ÿßÿ™':lang==='en'?'You will be notified of any updates':'Vous serez notifi√© des mises √† jour.',
          tag:'sofra-welcome'
        });
      });
    }
  }
};

// ‚îÄ‚îÄ LANGUAGE ‚îÄ‚îÄ
const TL={
  fr:{nav_tagline:'Aide alimentaire pour √©tudiants ¬∑ Ramadan 2026',tagline_fr:'La table est ouverte pour tous',btn_new:'Je suis nouveau',btn_new_sub:'Premi√®re inscription ‚Äî cr√©er mon profil',btn_existing:"J'ai d√©j√† donn√© mes infos",btn_existing_sub:'Compl√©ter mon profil ¬∑ v√©rifier mon statut',staff_login:'Connexion Staff',s_students:'√âtudiants',s_fasting:'En je√ªne',s_served:'Servis',ramadan_label:'Ramadan 1447 ¬∑ 2026',notif_prompt:'Recevoir les annonces en temps r√©el ? Activez les notifications.',notif_btn:'Activer',ann_section:'Annonces'},
  ar:{nav_tagline:'ŸÖÿ≥ÿßÿπÿØÿßÿ™ ÿ∫ÿ∞ÿßÿ¶Ÿäÿ© ŸÑŸÑÿ∑ŸÑÿßÿ® ¬∑ ÿ±ŸÖÿ∂ÿßŸÜ 2026',tagline_fr:'ÿßŸÑŸÖÿßÿ¶ÿØÿ© ŸÖŸÅÿ™Ÿàÿ≠ÿ© ŸÑŸÑÿ¨ŸÖŸäÿπ',btn_new:'ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ',btn_new_sub:'ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ŸÑÿ£ŸàŸÑ ŸÖÿ±ÿ©',btn_existing:'ÿ≥ÿ¨ŸÑÿ™ ŸÖÿ≥ÿ®ŸÇÿßŸã',btn_existing_sub:'ÿ£ŸÉŸÖŸÑ ŸÖŸÑŸÅŸä ¬∑ ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿßŸÑÿ™Ÿä',staff_login:'ÿØÿÆŸàŸÑ ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ',s_students:'ÿ∑ÿßŸÑÿ®',s_fasting:'ÿµÿßÿ¶ŸÖ',s_served:'ÿßÿ≥ÿ™ŸÑŸÖ',ramadan_label:'ÿ±ŸÖÿ∂ÿßŸÜ 1447 ¬∑ 2026',notif_prompt:'ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ ŸÅŸàÿ± ŸÜÿ¥ÿ±Ÿáÿßÿü ŸÅÿπŸëŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™.',notif_btn:'ÿ™ŸÅÿπŸäŸÑ',ann_section:'ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™'},
  en:{nav_tagline:'Student food aid ¬∑ Ramadan 2026',tagline_fr:'The table is open for all',btn_new:'New student',btn_new_sub:'First registration ‚Äî create my profile',btn_existing:'Already registered',btn_existing_sub:'Complete my profile ¬∑ check my status',staff_login:'Staff Login',s_students:'Students',s_fasting:'Fasting',s_served:'Served',ramadan_label:'Ramadan 1447 ¬∑ 2026',notif_prompt:'Receive announcements in real time? Enable notifications.',notif_btn:'Enable',ann_section:'Announcements'}
};
let lang='fr';
window.setLang=function(l){
  lang=l;
  document.documentElement.lang=l;
  document.documentElement.dir=l==='ar'?'rtl':'ltr';
  document.querySelectorAll('.lbtn').forEach(b=>{
    b.classList.toggle('active',(l==='fr'&&b.textContent==='FR')||(l==='ar'&&b.textContent==='AR')||(l==='en'&&b.textContent==='EN'));
  });
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key=el.getAttribute('data-i18n');
    if(TL[l]&&TL[l][key])el.textContent=TL[l][key];
  });
  const pt=document.getElementById('notifPromptText');
  const pb=document.getElementById('notifPromptBtn');
  const al=document.getElementById('ann-section-label');
  if(pt&&TL[l]?.notif_prompt)pt.textContent=TL[l].notif_prompt;
  if(pb&&TL[l]?.notif_btn)pb.textContent=TL[l].notif_btn;
  if(al&&TL[l]?.ann_section)al.textContent=TL[l].ann_section;
};
</script>
</body>
</html>